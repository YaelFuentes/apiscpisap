# üéØ Ejemplos Pr√°cticos - Panel de Administraci√≥n

## üìã √çndice de Ejemplos

1. [Identificar API Disponible para PI3](#ejemplo-1-identificar-api-disponible-para-pi3)
2. [Crear PI3 en Evaluar](#ejemplo-2-crear-pi3-en-evaluar)
3. [Crear API para Webhook de SAP](#ejemplo-3-crear-api-para-webhook-de-sap)
4. [Limpiar Base de Datos Grande](#ejemplo-4-limpiar-base-de-datos-grande)
5. [Crear API para XML de SAP](#ejemplo-5-crear-api-para-xml-de-sap)

---

## Ejemplo 1: Identificar API Disponible para PI3

### Escenario:
Quieres saber qu√© API de Evaluar puedes usar sin conflictos para una nueva integraci√≥n PI3.

### Pasos:

1. **Abre el panel de Admin**:
   ```
   http://localhost:3000
   Click en "‚öôÔ∏è Admin"
   ```

2. **Busca en "APIs Disponibles"**:
   - Mira las APIs de Evaluar
   - Busca las que est√°n en **VERDE** (disponibles)

3. **Ejemplo Visual**:
   ```
   üü• /api/evaluar/qas-https-status    [En uso] [üìã Copiar]
      √öltima ejecuci√≥n: 28/10/2025, 12:30:45
   
   üü© /api/evaluar/qas-https-logs       [Disponible] [üìã Copiar]
   
   üü© /api/evaluar/qas-https-metrics    [Disponible] [üìã Copiar]
   ```

4. **Copiar URL**:
   - Click en "üìã Copiar" de la API verde
   - URL copiada al portapapeles

5. **Resultado**:
   ‚úÖ Sabes que `/api/evaluar/qas-https-logs` est√° disponible  
   ‚úÖ Puedes usarla para PI3 sin conflictos

---

## Ejemplo 2: Crear PI3 en Evaluar

### Escenario:
Necesitas agregar "SAP PI - Eliminar Usuario" como PI3 en el proyecto Evaluar.

### Pasos:

1. **Ir a Gesti√≥n de Integraciones**:
   ```
   Admin > Gesti√≥n de Integraciones
   Click en "+ Nueva Integraci√≥n"
   ```

2. **Llenar Formulario**:
   ```
   Nombre: SAP PI - Eliminar Usuario
   Descripci√≥n: Eliminaci√≥n l√≥gica de usuarios en SAP
   Proyecto: Evaluar ‚ñº
   Criticidad: Alta ‚ñº
   ```

3. **Crear**:
   - Click en bot√≥n "Crear"
   - Espera confirmaci√≥n

4. **Resultado**:
   ```
   ‚úÖ Integraci√≥n creada:
   ID: EVALU-QAS-003
   Nombre: SAP PI - Eliminar Usuario
   ```

5. **Verificar**:
   - Ve a "üìä Monitor"
   - Selecciona "Evaluar"
   - Ver√°s la nueva integraci√≥n PI3

6. **Usar en API**:
   ```bash
   # Ahora puedes usarla
   curl "http://localhost:3000/api/evaluar/qas-https-logs?integracion=EVALU-QAS-003"
   ```

---

## Ejemplo 3: Crear API para Webhook de SAP

### Escenario:
Necesitas recibir notificaciones de SAP en formato JSON.

### Pasos:

1. **Crear API Gen√©rica**:
   ```
   Admin > APIs Disponibles > "+ Nueva API"
   ```

2. **Configurar**:
   ```
   Nombre: sap-webhook
   Descripci√≥n: Recibe notificaciones de SAP PI
   Formato: JSON ‚ñº
   ```

3. **Crear API**:
   - Click "Crear API"
   - Sistema muestra: "API creada: /api/generic/sap-webhook"

4. **Copiar URL**:
   - La API aparece en el panel
   - Click "üìã Copiar"

5. **Configurar en SAP**:
   ```
   URL: http://tu-dominio.vercel.app/api/generic/sap-webhook
   M√©todo: POST
   Content-Type: application/json
   ```

6. **Probar**:
   ```bash
   curl -X POST http://localhost:3000/api/generic/sap-webhook \
     -H "Content-Type: application/json" \
     -d '{
       "evento": "usuario_creado",
       "usuario_id": 12345,
       "nombre": "Juan P√©rez",
       "timestamp": "2025-10-28T12:00:00Z"
     }'
   ```

7. **Respuesta**:
   ```json
   {
     "success": true,
     "mensaje": "Datos recibidos exitosamente",
     "correlationId": "CORR-API-SAP-WEBHOOK-1730123456789",
     "formato": "json",
     "timestamp": "2025-10-28T12:30:45.123Z"
   }
   ```

8. **Consultar Ejecuciones**:
   ```bash
   curl http://localhost:3000/api/generic/sap-webhook
   ```

9. **Ver en Dashboard**:
   - Ve a "üìã Logs"
   - Filtra por integraci√≥n "API-SAP-WEBHOOK"
   - Ver√°s todos los datos recibidos

---

## Ejemplo 4: Limpiar Base de Datos Grande

### Escenario:
Tu base de datos tiene 15,000 logs y ocupa 25 MB. Quieres liberar espacio.

### An√°lisis Inicial:

1. **Ver Estad√≠sticas**:
   ```
   Admin > Panel Superior
   
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ Total APIs   ‚îÇ Integraciones‚îÇ Logs Totales ‚îÇ Tama√±o BD    ‚îÇ
   ‚îÇ     12       ‚îÇ      12      ‚îÇ   15,000     ‚îÇ   25.4 MB    ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ```

2. **Decidir Per√≠odo**:
   - Logs > 7 d√≠as: Elimina demasiado (desarrollo activo)
   - Logs > 30 d√≠as: ‚úÖ Balance ideal
   - Logs > 90 d√≠as: Muy conservador

### Pasos de Limpieza:

3. **Ejecutar Limpieza**:
   ```
   Admin > Limpieza de Datos
   Click en "Limpiar logs > 30 d√≠as"
   ```

4. **Confirmar**:
   ```
   ‚ö†Ô∏è ¬øEliminar logs mayores a 30 d√≠as?
   [Aceptar] [Cancelar]
   ```
   - Click "Aceptar"

5. **Resultado**:
   ```
   ‚úÖ Eliminados: 12,500 logs y 3,200 ejecuciones mayores a 30 d√≠as
   ```

6. **Verificar Nuevo Tama√±o**:
   ```
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ Total APIs   ‚îÇ Integraciones‚îÇ Logs Totales ‚îÇ Tama√±o BD    ‚îÇ
   ‚îÇ     12       ‚îÇ      12      ‚îÇ   2,500      ‚îÇ   8.2 MB     ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ```

7. **Resultado**:
   - ‚úÖ Espacio liberado: 17.2 MB (67%)
   - ‚úÖ Logs conservados: 2,500 (√∫ltimos 30 d√≠as)
   - ‚úÖ Sistema m√°s r√°pido

---

## Ejemplo 5: Crear API para XML de SAP

### Escenario:
SAP env√≠a datos en formato XML y necesitas una API para recibirlos.

### Pasos:

1. **Crear API XML**:
   ```
   Admin > "+ Nueva API"
   
   Nombre: sap-xml-receiver
   Descripci√≥n: Recibe documentos XML de SAP
   Formato: XML ‚ñº
   ```

2. **Crear**:
   - Click "Crear API"
   - URL generada: `/api/generic/sap-xml-receiver`

3. **Enviar XML desde SAP**:
   ```xml
   POST http://localhost:3000/api/generic/sap-xml-receiver
   Content-Type: application/xml
   
   <?xml version="1.0" encoding="UTF-8"?>
   <notificacion>
     <evento>orden_creada</evento>
     <orden_id>ORD-12345</orden_id>
     <cliente>
       <id>CLI-789</id>
       <nombre>Empresa XYZ</nombre>
     </cliente>
     <monto>1500.00</monto>
     <moneda>USD</moneda>
     <timestamp>2025-10-28T12:00:00Z</timestamp>
   </notificacion>
   ```

4. **Respuesta de la API**:
   ```json
   {
     "success": true,
     "mensaje": "Datos recibidos exitosamente",
     "correlationId": "CORR-API-SAP-XML-RECEIVER-1730123456789",
     "formato": "xml",
     "timestamp": "2025-10-28T12:30:45.123Z"
   }
   ```

5. **Consultar Ejecuciones**:
   ```bash
   curl http://localhost:3000/api/generic/sap-xml-receiver
   ```

   ```json
   {
     "api": "sap-xml-receiver",
     "apiId": "API-SAP-XML-RECEIVER",
     "formato": "xml",
     "ejecuciones": [
       {
         "id": 1,
         "estado": "success",
         "fecha_inicio": "2025-10-28T12:30:45.123Z",
         "mensajes_procesados": 1,
         "correlation_id": "CORR-API-SAP-XML-RECEIVER-1730123456789"
       }
     ],
     "total": 1
   }
   ```

6. **Ver Logs**:
   ```
   Dashboard > üìã Logs
   Filtrar por: API-SAP-XML-RECEIVER
   
   Ver√°s:
   ‚úÖ SUCCESS - Datos recibidos en formato xml
   ```

---

## üéØ Caso Completo: Setup para Proyecto Nuevo

### Escenario:
Necesitas configurar todo para un nuevo proyecto "Facturaci√≥n".

### Paso 1: Crear Integraciones

```
Admin > "+ Nueva Integraci√≥n"

1. Nombre: SAP Facturaci√≥n - Crear Factura
   Proyecto: Evaluar
   Criticidad: Alta
   ‚Üí ID generado: EVALU-QAS-004

2. Nombre: SAP Facturaci√≥n - Consultar Estado
   Proyecto: Evaluar
   Criticidad: Media
   ‚Üí ID generado: EVALU-QAS-005

3. Nombre: SAP Facturaci√≥n - Anular Factura
   Proyecto: Evaluar
   Criticidad: Alta
   ‚Üí ID generado: EVALU-QAS-006
```

### Paso 2: Crear APIs Gen√©ricas

```
Admin > "+ Nueva API"

1. Nombre: facturacion-webhook
   Formato: JSON
   ‚Üí URL: /api/generic/facturacion-webhook

2. Nombre: facturacion-xml
   Formato: XML
   ‚Üí URL: /api/generic/facturacion-xml
```

### Paso 3: Verificar APIs Disponibles

```
Admin > APIs Disponibles

Buscar APIs en VERDE:
‚úÖ /api/evaluar/qas-https-logs
‚úÖ /api/generic/facturacion-webhook
‚úÖ /api/generic/facturacion-xml
```

### Paso 4: Copiar URLs

```
Para cada API verde:
1. Click "üìã Copiar"
2. Pegar en documento de configuraci√≥n SAP
```

### Paso 5: Probar

```bash
# Test 1: Crear factura (webhook JSON)
curl -X POST http://localhost:3000/api/generic/facturacion-webhook \
  -H "Content-Type: application/json" \
  -d '{
    "tipo": "crear_factura",
    "cliente_id": "CLI-123",
    "monto": 500.00,
    "items": [...]
  }'

# Test 2: Consultar logs
curl "http://localhost:3000/api/evaluar/qas-https-logs?integracion=EVALU-QAS-004"

# Test 3: Ver en dashboard
# http://localhost:3000 > Evaluar > Monitor
```

### Resultado Final:

‚úÖ 3 integraciones creadas  
‚úÖ 2 APIs gen√©ricas configuradas  
‚úÖ URLs copiadas para SAP  
‚úÖ Todo listo para recibir datos

---

## üí° Tips Pr√°cticos

### Tip 1: Nombres de APIs
```
‚ùå Mal: "Mi API 123" ‚Üí /api/generic/mi-api-123
‚úÖ Bien: "webhook-sap" ‚Üí /api/generic/webhook-sap

‚úÖ Usa guiones, no espacios
‚úÖ Todo en min√∫sculas
‚úÖ Descriptivo y corto
```

### Tip 2: Limpiar Regularmente
```
Desarrollo: Limpiar cada 7 d√≠as
Testing: Limpiar cada 30 d√≠as
Producci√≥n: Limpiar cada 90 d√≠as

Programar con cron:
0 0 * * 0 curl -X POST http://localhost:3000/api/admin/clean-logs -d '{"days":30}'
```

### Tip 3: Backup Antes de Eliminar
```powershell
# Backup local
Copy-Item ".\data\sap-cpi-monitor.db" ".\backups\backup-$(Get-Date -Format 'yyyyMMdd').db"

# Luego limpiar
Admin > Limpiar logs > 30 d√≠as
```

### Tip 4: Identificar APIs R√°pido
```
Color = Estado
üü• Rojo = Usada recientemente ‚Üí Evitar
üü© Verde = Disponible ‚Üí Usar sin problemas
```

### Tip 5: Organizar Integraciones
```
Criticidad:
- Alta: Procesos cr√≠ticos del negocio
- Media: Procesos importantes pero no cr√≠ticos
- Baja: Testing y validaciones
```

---

## üöÄ Automatizaci√≥n con Scripts

### Script: Limpiar BD Semanalmente

```javascript
// scripts/weekly-cleanup.js
import fetch from 'node-fetch';

async function cleanupWeekly() {
  const res = await fetch('http://localhost:3000/api/admin/clean-logs', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ days: 30 })
  });
  
  const data = await res.json();
  console.log(`‚úÖ Limpieza completada: ${data.deleted} logs eliminados`);
}

cleanupWeekly();
```

```powershell
# Ejecutar cada domingo
node scripts/weekly-cleanup.js
```

---

**¬°Ejemplos listos para usar!** üéâ

Copia y adapta estos ejemplos a tus necesidades espec√≠ficas.
